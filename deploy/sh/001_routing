#!/bin/bash

# Code generated by gen/template/plat::deployscript.sh.jinja; DO NOT EDIT.

set -euo pipefail -o posix

cd "$(dirname "$0")/../../"

. deploy-script-header.sh

template_file="./deploy/cfn/${template_name}"

Vpc=$(cfn-get-export Vpc --prefix)
SubnetPubA=$(cfn-get-export SubnetPubA --prefix)
SubnetPriAppA=$(cfn-get-export SubnetPriAppA --prefix)
SubnetPriDbA=$(cfn-get-export SubnetPriDbA --prefix)
SubnetPubC=$(cfn-get-export SubnetPubC --prefix)
SubnetPriAppC=$(cfn-get-export SubnetPriAppC --prefix)
SubnetPriDbC=$(cfn-get-export SubnetPriDbC --prefix)

sam validate --template-file "${template_file}"
optwait cfn stack "${stack_name}"
sam deploy \
    --template-file "${template_file}" \
    --stack-name "${stack_name}" \
    --capabilities CAPABILITY_NAMED_IAM \
    --resolve-s3 \
    --no-fail-on-empty-changeset \
    --on-failure DELETE \
    --parameter-overrides "\
Prefix=\"${OP_PREFIX}\" \
Env=\"${OP_ENV}\" \
Vpc=\"${Vpc}\" \
SubnetPubA=\"${SubnetPubA}\" \
SubnetPriAppA=\"${SubnetPriAppA}\" \
SubnetPriDbA=\"${SubnetPriDbA}\" \
SubnetPubC=\"${SubnetPubC}\" \
SubnetPriAppC=\"${SubnetPriAppC}\" \
SubnetPriDbC=\"${SubnetPriDbC}\" \
"
